{
    "contents" : "## Script cleans sensor data from Galaxy S device for analysis.\n## 1. Merges the training and test sets to create \"master\" data set.\n## 2. Cleans all column names, reformatting several.\n## 3. Decodes activity label by showing the corresponding activity name.\n## 4. Outputs that file as \"masterData.txt\".\n## 5. Calculates average for 70 key mean and std dev variables. \n## 6. Outputs calcs by activity and subject as \"activitySubjectMeans.txt\".\n\n## Load required libraries.\nlibrary(plyr)\n\n## If data directory exists, change to that directory.\n## Else, create data directory, download and unzip raw data files.\nif(file.exists(\"./data\")) {\n     setwd(\"./data\")\n} else {\n     dir.create(\"./data\")\n     fileUrl<-\"https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip\"\n     download.file(fileUrl,destfile=\"./data/zipfile.zip\",method=\"curl\")\n     setwd(\"./data\")\n     unzip(\"zipfile.zip\", files = NULL, list = FALSE, overwrite = TRUE,\n           junkpaths = FALSE, exdir = \".\", unzip = \"internal\",\n           setTimes = FALSE)\n}\n\n## Read raw data files into memory for processing.\ntrainSubj<-read.table(\"./UCI HAR Dataset/train/subject_train.txt\",header=FALSE)\ntrainY<-read.table(\"./UCI HAR Dataset/train/y_train.txt\",header=FALSE)\ntrainX<-read.table(\"./UCI HAR Dataset/train/X_train.txt\",header=FALSE)\ntestSubj<-read.table(\"./UCI HAR Dataset/test/subject_test.txt\",header=FALSE)\ntestY<-read.table(\"./UCI HAR Dataset/test/y_test.txt\",header=FALSE)\ntestX<-read.table(\"./UCI HAR Dataset/test/X_test.txt\",header=FALSE)\nfeatures<-read.table(\"./UCI HAR Dataset/features.txt\",header=FALSE)\nactivityLabels<-read.table(\"./UCI HAR Dataset/activity_labels.txt\",header=FALSE)\n\n## Join train and test files.\nsubjects<-rbind(trainSubj,testSubj)\nactivities<-rbind(trainY,testY)\nreadings<-rbind(trainX,testX)\n\n## Set counter maximums for later.\ntmp<-count(unique(subjects)); subjectNum<-sum(tmp$freq)\ntmp<-count(unique(activityLabels)); labelNum<-sum(tmp$freq)\n\n## Remove working files.\nrm(trainSubj,testSubj,trainY,testY,trainX,testX)\n\n## Decode activity label and put result in new activity name column.\nactivities$activityName<-activityLabels[activities$V1,2]\n\n## Clean feature names removing problematic text\ncleanFeatures<-gsub(\"([()])\", \"\", features[,2])\ncleanFeatures<-gsub(\"([-])\",\"\",cleanFeatures)\ncleanFeatures<-gsub(\"([,])\",\"\",cleanFeatures)\ncolnames(readings)<-cleanFeatures\n\n## Join columns to create master file renaming some columns.\nmaster<-cbind(activities,subjects)\ncolnames(master)<-c(\"activityLabel\",\"activityName\",\"activitySubject\")\nmaster<-cbind(master,readings[,41:46],readings[,214:215],readings[,253:254],\n              readings[,266:271],readings[,345:350],readings[,424:429],\n              readings[,503:504],readings[,516:517],\n              readings[,529:530],readings[,542:543])\n\n## Remove working files\nrm(subjects,activities,readings,features,cleanFeatures)\n\n## Sort master - used for debugging master file creation only.\nmaster<-master[order(master$activitySubject,desc(master$activityLabel)),]\n\n## Initialize return matrix for processing.\noutput<-matrix(NA,labelNum*subjectNum,length(master))\noutput<-as.data.frame(output)\ncolnames(output)<-names(master)\noutputCtr<-1\n\n## Couldn't find an easy way to melt/dcast or data.table/.SD given the\n## 70 means to be returned. So, looping through manually.\nfor(i in 1:labelNum){\n     tmpAct<-master[master$activityLabel==i,]\n     for(j in 1:subjectNum){\n          tmpActSubj<-tmpAct[tmpAct$activitySubject==j,]\n          output[outputCtr,1]<-i\n          output[outputCtr,2]<-as.character(activityLabels[i,2])\n          output[outputCtr,3]<-j\n          for(k in 1:(length(master)-3)){\n               output[outputCtr,k+3]<-mean(tmpActSubj[,k+3])\n          }\n          outputCtr<-outputCtr+1\n     }\n}\n## Save output files.\nwrite.table(master,\"masterData.txt\",row.names=T,col.names=T) \nwrite.table(output,\"activitySubjectMeans.txt\",row.names=T,col.names=T) \nlistOfVariables <- data.frame(names(output))\nwrite.csv(listOfVariables,\"listOfVariables.csv\")\n\n## Remove working files.\nrm(tmp,tmpAct,tmpActSubj,activityLabels,listOfVariables)\nrm(master,output,i,j,k,labelNum,outputCtr,subjectNum)\nsetwd(\"../\")",
    "created" : 1401039451478.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "586622319",
    "id" : "E327D7DF",
    "lastKnownWriteTime" : 1401039367,
    "path" : "~/run_analysis/run_analysis.R",
    "project_path" : "run_analysis.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}